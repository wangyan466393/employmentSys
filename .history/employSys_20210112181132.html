<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/ljp_employSys.css">
  <!-- 引入样式 -->
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/element-ui/2.14.1/theme-chalk/index.css">
  <title>就业实习跟踪系统</title>
</head>

<body class="content_body">
  <div id="app">
    <div class="header">
      <div class="logo"></div>
      <div class="login_name">
        <span class="avatar">
          <img src="imgs/avatar_ljp.png" alt="">
        </span>
        <span class="username">{{loginName.name}}</span>
      </div>
    </div>
    <div class="main">
      <div class="content">
        <div class="content_top">
          <div class="content_title"></div>
          <div class="content_handle">
            <!-- <a href="#" class="icon_edit">数据修改</a> -->
            <template v-if="roleBool">
              <a href="javascript:;" class="file"> 导入数据
                <input type="file" class="uploadExcel" accept=".xls, .xlsx" id="importExcel"
                  @change="submitCollectionFlowImport" />
              </a>
              <!-- <a href="#" class="icon_import">导入数据</a> -->
              <a href="#" class="icon_export">导出数据</a>
            </template>
            <el-input placeholder="学校或班级名称" suffix-icon="el-icon-search" v-model="search">
            </el-input>
          </div>
        </div>
        <div class="table_content">
          <template v-if="id ==''">
            <!-- 所有合作院校数据 -->
            <el-table ref="multipleTable"
              :header-cell-style="{color: '#fff', fontSize: '12px', backgroundColor: '#3e85ff'}"
              :data="search ?tableData.filter(data => !search || searchFilter(data)) : pageFilter"
              @selection-change="handleSelectionChange" tooltip-effect="dark"
              style="width: 100%;padding: 10px;border: none;">
              <el-table-column type="selection" width="55">
              </el-table-column>
              <el-table-column label="序号" width="60">
                <template slot-scope="scope">{{ scope.row.id }}</template>
              </el-table-column>
              <el-table-column prop="college" label="院校" min-width="160">
                <template slot-scope="scope">{{ scope.row.college }}</template>
              </el-table-column>
              <el-table-column prop="grade" label="年级" min-width="60">
                <template slot-scope="scope">{{ scope.row.grade }}</template>
              </el-table-column>
              <el-table-column prop="education" label="学历" min-width="60">
                <template slot-scope="scope">{{ scope.row.education }}</template>
              </el-table-column>
              <el-table-column prop="subject" label="专业方向" min-width="120">
              </el-table-column>
              <el-table-column prop="studentCount" label="年级学生总数(人)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column prop="higherSchoolCount" label="专升本数量(人)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column prop="jobStuCount" label="就业总数(人)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column prop="autonomouslyCount" label="自主就业(人)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column prop="recommendCount" label="推荐就业(人)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column prop="subjectCount" label="专业对口(人)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column prop="starCount" label="就业明星(人)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column prop="salaryAvg" label="实习平均薪资(元)" show-overflow-tooltip min-width="120">
                <span>¥</span>
                <template slot-scope="scope">{{ "¥" + scope.row.salaryAvg }}</template>
              </el-table-column>
              <el-table-column prop="allRate" label="整体就业率(%)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column prop="aecommendRate" label="推荐就业率(%)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column prop="subjectRate" label="专业对口率(%)" show-overflow-tooltip min-width="120">
              </el-table-column>
              <el-table-column label="操作" width="100">
                <template slot-scope="scope">
                  <el-button @click="studentListData(scope.row)" type="text" size="small">查看</el-button>
                  <el-button type="text" size="small">编辑</el-button>
                </template>
              </el-table-column>
            </el-table>
          </template>
          <template v-else>
            <!-- 院校对应学生数据 -->
            <el-table :header-cell-style="{color: '#fff', fontSize: '12px', backgroundColor: '#3e85ff'}"
              :data="stusListData" style="width: 100%;padding: 10px;border: none;">
              <el-table-column type="selection" width="55">
              </el-table-column>
              <el-table-column label="序号" width="60">
                <template slot-scope="scope">{{ scope.row.id }}</template>
              </el-table-column>
              <el-table-column label="姓名" width="100">
                <template slot-scope="scope">{{ scope.row.name }}</template>
              </el-table-column>
              <el-table-column label="性别" width="60">
                <template slot-scope="scope">{{ scope.row.gender }}</template>
              </el-table-column>
              <el-table-column label="班级" width="80">
                <template slot-scope="scope">{{ scope.row.gradeName }}</template>
              </el-table-column>
              <el-table-column prop="educationName" label="学历" width="80">
                <template slot-scope="scope">{{ scope.row.educationName }}</template>
              </el-table-column>
              <el-table-column prop="phone" label="电话" min-width="120">
                <template slot-scope="scope">{{ scope.row.phone }}</template>
              </el-table-column>
              <el-table-column prop="company" label="入职公司" show-overflow-tooltip min-width="100">
              </el-table-column>
              <el-table-column prop="salary" label="薪资(元)" show-overflow-tooltip min-width="100">
                <span>¥</span>
                <template slot-scope="scope">{{ "¥" + scope.row.salary }}</template>
              </el-table-column>
              <el-table-column prop="address" label="工作地点" width="120" show-overflow-tooltip>
                <template slot-scope="scope">{{ scope.row.address }}</template>
              </el-table-column>
              <el-table-column prop="jobdate" label="入职日期" width="120">
                <template slot-scope="scope">{{ scope.row.jobdate }}</template>
              </el-table-column>
              <el-table-column prop="subjectName" label="专业方向" width="120">
              </el-table-column> -->
              <el-table-column prop="empType" label="就业方式" width="120">
                <template slot-scope="scope">{{ scope.row.empType }}</template>
              </el-table-column>
              <el-table-column prop="orRight" label="专业对口" width="120">
                <template slot-scope="scope">{{ scope.row.orRight ? "是" : "否" }}</template>
              </el-table-column>
              <el-table-column label="个人简介" width="120" show-overflow-tooltip>
                <template slot-scope="scope">{{ "无" }}</template>
              </el-table-column>
              <el-table-column label="工作经历" width="120" show-overflow-tooltip>
                <template slot-scope="scope">{{ scope.row.workExperience ? scope.row.workExperience : "无" }}</template>
              </el-table-column>
              <el-table-column>
              align="right">
              <template slot="header" slot-scope="scope">
                <el-input
                  v-model="search"
                  size="mini"
                  placeholder="输入关键字搜索"/>
              </template>
              <template slot-scope="scope">
                <el-button
                  size="mini"
                  @click="handleEdit(scope.$index, scope.row)">Edit</el-button>
                <el-button
                  size="mini"
                  type="danger"
                  @click="handleDelete(scope.$index, scope.row)">Delete</el-button>
              </template>
            </el-table-column>
              <el-table-column width="100" align="right">
                <template slot="header" slot-scope="scope">
                  <el-button icon="el-icon-back" round size="mini" @click="handleClickBack(scope.row)"
                    style="padding: 5px 12px;"></el-button>
                </template>
                <template slot-scope="scope">
                  <el-button @click="handleClickDetails(scope.row)" type="text" size="small">查看</el-button>
                </template>
              </el-table-column>
            </el-table>
          </template>
          <el-pagination small layout="prev, pager, next" :page-size="pageSize" @prev-click="prevPage"
            @next-click="nextPage" @current-change="currentPageFunc" :current-page='currentPage'
            :total="search ? pageFilter.length : tableData.length ">
          </el-pagination>
        </div>
      </div>
    </div>
    <el-drawer title="我是标题" :visible.sync="drawerDetails" :with-header="false">
      <span>我来啦!</span>
    </el-drawer>
  </div>
  <script src="js/jquery-1.11.3.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.0/axios.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.9/vue.js"></script>
  <script src="js/element-ui.js"></script>
  <script src="js/api.js"></script>
  <script>
    new Vue({
      el: '#app',
      data() {
        return {
          drawerDetails: false,//弹框默认不显示
          id: '',
          search: '', //搜索
          pageSize: 5,  //默认一页显示数据个数
          currentPage: 1,  //当前页码
          tableData: [{
            "id": 1,
            "education": "高职",
            "college": "九江职业技术学院",
            "grade": "19级",
            "subject": "java开发",
            "studentCount": 1,
            "higherSchoolCount": 0,
            "jobStuCount": 1,
            "autonomouslyCount": 0,
            "recommendCount": 1,
            "subjectCount": 1,
            "allRate": null,
            "aecommendRate": null,
            "subjectRate": null,
            "salaryAvg": 5555,
            "starCount": null
          }, {
            "id": 2,
            "education": "高职",
            "college": "九江职业技术学院",
            "grade": "19级",
            "subject": "java开发",
            "studentCount": 1,
            "higherSchoolCount": 0,
            "jobStuCount": 1,
            "autonomouslyCount": 0,
            "recommendCount": 1,
            "subjectCount": 1,
            "allRate": null,
            "aecommendRate": null,
            "subjectRate": null,
            "salaryAvg": 5555,
            "starCount": null
          }, {
            "id": 3,
            "education": "高职",
            "college": "九江职业技术学院",
            "grade": "19级",
            "subject": "java开发",
            "studentCount": 1,
            "higherSchoolCount": 0,
            "jobStuCount": 1,
            "autonomouslyCount": 0,
            "recommendCount": 1,
            "subjectCount": 1,
            "allRate": null,
            "aecommendRate": null,
            "subjectRate": null,
            "salaryAvg": 5555,
            "starCount": null
          }, {
            "id": 4,
            "education": "高职",
            "college": "山东劳动职业技术学院",
            "grade": "19级",
            "subject": "Web前端开发",
            "studentCount": 1,
            "higherSchoolCount": 0,
            "jobStuCount": 1,
            "autonomouslyCount": 0,
            "recommendCount": 1,
            "subjectCount": 1,
            "allRate": null,
            "aecommendRate": null,
            "subjectRate": null,
            "salaryAvg": 5555,
            "starCount": null
          }, {
            "id": 5,
            "education": "高职",
            "college": "九江职业技术学院",
            "grade": "19级",
            "subject": "java开发",
            "studentCount": 1,
            "higherSchoolCount": 0,
            "jobStuCount": 1,
            "autonomouslyCount": 0,
            "recommendCount": 1,
            "subjectCount": 1,
            "allRate": null,
            "aecommendRate": null,
            "subjectRate": null,
            "salaryAvg": 5555,
            "starCount": null
          },{
            "id": 6,
            "education": "高职",
            "college": "九江职业技术学院",
            "grade": "19级",
            "subject": "java开发",
            "studentCount": 1,
            "higherSchoolCount": 0,
            "jobStuCount": 1,
            "autonomouslyCount": 0,
            "recommendCount": 1,
            "subjectCount": 1,
            "allRate": null,
            "aecommendRate": null,
            "subjectRate": null,
            "salaryAvg": 5555,
            "starCount": null
          },{
            "id": 7,
            "education": "高职",
            "college": "九江职业技术学院",
            "grade": "19级",
            "subject": "java开发",
            "studentCount": 1,
            "higherSchoolCount": 0,
            "jobStuCount": 1,
            "autonomouslyCount": 0,
            "recommendCount": 1,
            "subjectCount": 1,
            "allRate": null,
            "aecommendRate": null,
            "subjectRate": null,
            "salaryAvg": 5555.01,
            "starCount": null
          },],
          stusListData: [],   //指定学校下的学生列表 数据
          multipleSelection: [],   //选中数据
          loginName: "",
          roleBool: false

        }
      },
      created() {
        let loginInfo = localStorage.getItem("loginInfo");
        this.loginName = JSON.parse(loginInfo)
        if (this.loginName.roleId == 1) {
          this.roleBool = true;
        }
      },
      computed: {
        //分页
        pageFilter() {
          //开始数据的下标
          let startVal = parseInt((this.currentPage - 1) * this.pageSize);
          return this.tableData.slice(startVal, startVal + this.pageSize);
          //1页 0  5  1-1 *5     (currentPage-1)*pageSize    (currentPage-1)*pageSize + pageSize
          //2页 5 10   2-1 *5
          //3页 10 15   3-1 *5
        },

      },
      methods: {
        ///搜索条件
        searchFilter(data) {
          return data.date.toLowerCase().includes(this.search.toLowerCase()) || data.name.toLowerCase().includes(this.search.toLowerCase())
        },
        handleSelectionChange(val) {
          console.log(val);
          this.multipleSelection = val;
        },
        //编辑
        handleClick(obj) {
          console.log(obj)
        },
        handleClickBack() {
          this.id = "";
        },
        //分页切换，上一页
        prevPage(val) {
          this.currentPage = val
        },
        //下一页
        nextPage(val) {
          this.currentPage = val
        },
        //当前页
        currentPageFunc(val) {
          this.currentPage = val
        },
        //导入数据
        submitCollectionFlowImport: function (type) {
          var _self = this;
          let fileFormData = new FormData();
          fileFormData.append("file", $("#importExcel")[0].files[0]);
          let requestConfig = {
            headers: {
              "Content-Type": "multipart/form-data",
            },
          };
          const instance = axios.create({
            withCredentials: true,
          });

          instance
            .post(
              _self.url,
              fileFormData,
              requestConfig
            )
            .then((res) => {
              if (res.data.status == "ok") {
                alert('上传成功');
              } else {
                this.$message.error('上传失败，请重试！');
              }
            });
        },


        //分组查看学生列表，单击某个学校查看对应的学生数据
        async studentListData(obj) {
          this.id = obj.id;
          if (this.id) {
            let stuPramas = {
              "collegeId": 1,
              "gradeid": 5
            }
            this.stusListData = await studentListDataApi(stuPramas);
          }
        },
        //日期格式化
        format(time, format) {
          var t = new Date(time);
          var tf = function (i) {
            return (i < 10 ? '0' : '') + i
          };
          return format.replace(/yyyy|MM|dd|HH|mm|ss/g, function (a) {
            switch (a) {
              case 'yyyy':
                return tf(t.getFullYear());
                break;
              case 'MM':
                return tf(t.getMonth() + 1);
                break;
              case 'mm':
                return tf(t.getMinutes());
                break;
              case 'dd':
                return tf(t.getDate());
                break;
              case 'HH':
                return tf(t.getHours());
                break;
              case 'ss':
                return tf(t.getSeconds());
                break;
            }
          })
        }
      }
    })
  </script>
</body>

</html>